# 프론트엔드 업데이트 - 다중 조 매칭 지원

## 변경 사항

백엔드에서 하나의 사용자 조항이 여러 표준계약서 조와 매칭될 수 있도록 변경됨에 따라, 프론트엔드도 이를 표시하도록 업데이트했습니다.

## 주요 변경 내용

### 1. Primary 매칭 표시

기존의 "조 단위 매칭 결과"를 "Primary 매칭"으로 변경하여 최고 점수 조를 명확히 표시합니다.

```python
# 변경 전
st.markdown(f"**조 단위 매칭 결과**: {std_article_id} ({std_article_title}) - 유사도: {similarity:.1%}")

# 변경 후
st.markdown(f"**Primary 매칭**: {std_article_id} ({std_article_title}) - 유사도: {similarity:.1%}")
```

### 2. 다중 조 매칭 경고

하위항목별로 다른 조가 매칭된 경우, 이를 명확히 표시합니다.

```python
if len(matched_articles) > 1:
    st.markdown(f"**⚠️ 다중 조 매칭** ({len(matched_articles)}개 조):")
    for article_id, info in matched_articles.items():
        avg_score = sum(info['scores']) / len(info['scores'])
        sub_items_str = ', '.join(map(str, info['sub_items']))
        st.markdown(f"  - {article_id} ({info['title']}): {avg_score:.1%} (하위항목 {sub_items_str})")
```

### 3. 하위항목별 상세 결과를 Expander로 변경

가독성 향상을 위해 하위항목별 상세 결과를 접을 수 있도록 변경했습니다.

```python
with st.expander(f"하위항목별 상세 ({len(sub_item_results)}개)", expanded=False):
    for sub_result in sub_item_results:
        # 상세 정보 표시
```

### 4. 필드명 변경 대응

백엔드 응답 형식 변경에 맞춰 필드명을 업데이트했습니다.

```python
# 변경 전
matched_parent = sub_result.get('parent_id', '')
matched_title = sub_result.get('title', '')

# 변경 후
matched_article = sub_result.get('matched_article_id', '')
matched_title = sub_result.get('matched_article_title', '')
```

## 화면 예시

### 케이스 1: 단일 조 매칭 (정상)

```
제5조 데이터 제공 범위 및 방식
Primary 매칭: 제5조 (데이터 제공 범위 및 방식) - 유사도: 79.7%

▼ 하위항목별 상세 (4개)
  1. 제공자는 이용자에게 다음 각 호의 데이터를 제공한다...
     → 제5조 (데이터 제공 범위 및 방식) - 78.5%
  2. 데이터의 종류: 고객 거래 데이터...
     → 제5조 (데이터 제공 범위 및 방식) - 80.0%
  3. 데이터의 형식: CSV 파일...
     → 제5조 (데이터 제공 범위 및 방식) - 80.8%
  4. 제공 방식: API를 통한 실시간 제공...
     → 제5조 (데이터 제공 범위 및 방식) - 79.3%
```

### 케이스 2: 다중 조 매칭 (경고)

```
제8조 혼합 조항
Primary 매칭: 제5조 (데이터 제공 범위 및 방식) - 유사도: 77.5%

⚠️ 다중 조 매칭 (3개 조):
  - 제5조 (데이터 제공 범위 및 방식): 77.5% (하위항목 1, 2)
  - 제7조 (데이터 이용 목적 및 범위): 72.0% (하위항목 3)
  - 제9조 (데이터 보안): 68.5% (하위항목 4)

▼ 하위항목별 상세 (4개)
  1. 데이터 제공 범위는...
     → 제5조 (데이터 제공 범위 및 방식) - 78.0%
  2. 데이터 형식은...
     → 제5조 (데이터 제공 범위 및 방식) - 77.0%
  3. 데이터 이용 목적은...
     → 제7조 (데이터 이용 목적 및 범위) - 72.0%
  4. 보안 조치는...
     → 제9조 (데이터 보안) - 68.5%
```

## 사용자 경험 개선

### 1. 명확한 정보 전달

- Primary 매칭: 가장 유사한 조를 명확히 표시
- 다중 조 매칭 경고: 사용자 조항이 여러 표준 조와 관련됨을 알림
- 하위항목별 상세: 각 하위항목이 어떤 조와 매칭되었는지 확인 가능

### 2. 가독성 향상

- Expander 사용으로 기본 화면 간결화
- 다중 조 매칭 시 요약 정보 먼저 표시
- 하위항목 인덱스로 빠른 참조 가능

### 3. 유사도 표시 정확성

- 모든 유사도가 0~100% 범위 내로 표시됨
- 조별 평균 유사도 계산으로 신뢰도 향상

## 호환성

- 기존 단일 조 매칭 케이스는 동일하게 표시됨
- 다중 조 매칭 시에만 추가 정보 표시
- 백엔드 응답 형식 변경에 완전히 대응

## 테스트 시나리오

1. **정상 케이스**: 모든 하위항목이 같은 조 매칭
2. **다중 조 케이스**: 하위항목별로 다른 조 매칭
3. **매칭 실패 케이스**: 검색 결과 없음
4. **부분 매칭 케이스**: 일부 하위항목만 매칭

## 영향 받는 파일

- `frontend/app.py`: 조항별 분석 결과 렌더링 로직
